#![cfg(test)]

use std::str::FromStr;

use crate::{
    error::PaymentError,
    model::{Signer, SignerError},
    utils,
    wallet::OnchainWallet,
};
use anyhow::Result;
use async_trait::async_trait;
use lazy_static::lazy_static;
use lwk_wollet::{
    elements::{Address, Transaction},
    Tip, WalletTx,
};

pub(crate) struct MockWallet {}

lazy_static! {
    pub(crate) static ref TEST_LIQUID_TX: Transaction = utils::deserialize_tx_hex("020000000101ad4f1152b3257e081c6f4bc67eef57bae997a152f6e4226454e24b49a45798a70100000000feffffff030bf5295cecc24c0aeb1813e12f974a7a4696a408bbcf4eda4d0270379e5ebd4ecf0934662cadc03364cf7729a25f733cc8999e0f2b12d9ccce3762bd170950e052a103733b0357c226e9b8d56d915ff369f3d10b1089875e358a6453e5a0cf0be0da9f225120110f1e9c0f2dba901ef79b45ebc181d87d86498798f37993f199b64e486aaa980bffc8792431bb1bf5a8a7e307d5fd0883467e2bff3473e1787cc2cf9c7103db6208518b412cf79f6d72e522de8b9c8d208ae00cd805d354c315523002bb2e4520a703e373df7c58aebcc4920f722ba5049f7ff2ec345021bbdace3a86bf8d329a552816001464a066ef48f5f3e1d486b1bac4e928e01ae93ad001499a818545f6bae39fc03b637f2a4e1e64e590cac1bc3a6f6d71aa4443654c140100000000000000fb0000a74a160000000247304402203fc6f037451c1c9b38b90cb788022fa051da1812f310461847cef98583b8d41502205781bf725787978dbe55e343334fc30687b9caccfc249561fd1e529ba987392f01210273aa2eda3cd21dedf796e3058e312c50c8275e674e765ea01c5fda74a288f3b30043010001e78cc52b1ffb6bab378a17f05de5531977b6017cf64a02df2c9b8ba19a376d0828de10fd9cf89db899dbec237feda1c02018f49df8c90a44d8adf63b1c8186ccfd4e1060330000000000000001885baf0128d296357c2c77e7abe462d33c7dc4861519e55d4edf7c4c5ba12fe947457349fd1f0a8b3046df64b1cf4aed94a5b2286a7ac434a34814b6660c8f347b77f06d2daf36cadcbc8c796fbb515c9ad38e6bcab4a66b346a3a1013886341e8cb1c92e7e25029b49091d4feef8d06516db1255a65f0eb55173b35e9b9f16a3825f7a7ca58988bbd9a0d600af8a806c506f911eb78384918d8a230f7dca14af328c84e6e6699679cba3a75cf942ff5d2e45342232377e5912c259e91e12331e3c0a3ec946e812f4dacd1717336633ffa005f29a81cf34b094ef9f74d4941a7b2b21ea6dd8367edaac115de9d2cbf1ea612377bcf784f3c9922a7a55e957734e67d2ed2a9d368f3d07be5fbe89ad3a67e6b53ba14449b2e74ee6b7f8aff85e39a5f09bbd53736a70ea38d32d6de580d723a25dacd8e68b3101cbfc9ff4e98fae44a1cc2bbbf8d5d3248a5157a15d17855a38bb4fa8f13aaaa2d1d3559f6b325c5e2a9b03f7606e40cc899e46534684acab1d3a6037bf2aa3c68f94fb4dbb63619e55d34d966bf596928bfb334191e486e3881096377a18e8c607ca27716cd3b342d761ef2d57d8faa4b833faa0ae449997eb807ddaccbbee97e87a2467a680df95b92d265e20183078976e3091b11330ef23e28fd713f67cc22b9e7752bacf7a01a09952b6e98bb80e7d6874320431a2194e9b5cd3c04316acad19e16201ad3d022eda5cace187b5af331922f9a60fff7468e148ab6164a14c7afa93fde9366d57e82bc4c0e90dea9000d21d6fc731b072fd83781fb6447fbf5c924f5feb70991aafe7ae79aadd436b42fa8deb696d13e8df31e17fe61ddd4d208ff5285347c65ebd0dee50f449ebe083312aec16d5044eaeceea10f749999618ad6cee5010daa0ac0208aff1dcefe2facf533a98184d563790e1b9b764ba8cb37f714f4e5d20801661d49d8c72634fab988584b6f091e18164d388f92b281d0f930b49665a4cd4b996968e9177d5f192d98c2eb930eb26cb024b09d338e24aee44a10e26fa7f96d1210931fe9999120df590f29e0eb279e3054abf330a864e814d56877c155eee1aeb9f40f6550bf472dc4860ca7ca685111d98bd57719a09698e4f610bb7bdf2f3d49729c9b86f095050a48baa000efce2c7bb77f476fba3ae01627337f3626f02771ab370f718208e0ae949c5de969f65456bfc476014af96af1a746aae5ddf1a9d566f8877367aaa906c2c4388bdd1f99993324d6a8391186620ea6e5e7b277ed3ecfee5094d69cf683a61e01a42bbe3bab92faefc18728332984a075598543ac3719a47f0387fac23e6f16badfbed8490f98dce7322382b6a8a08b5c8ebe819f5ed4208f4918017b37b23b32e55494ce359069549bee525713ab377687441ec8b6b3213923437d1acb207377992e753893d1b2a4cbbb3a3ece2a3090178c162f74488699eccc47d62cfb7c985145558fd8076c8075d4318eb9b12f5aeac1a9c7c5ee1d33681b5bb21bc3748b38bea4ac3079282226658fbeb124237aa3c1f317420fb16d6ba551a0739d142f47254a42d7068f2982261b67e46403b5287e4b60f2e3d826f1e527896d9c7748fc9705098716ef670ebc43a204fc19def123610d937f76bf63013e7d818924edec1e81d5f695f80490509e927804c054a2f3c049494402d38e55e693ddd29fb77a87639f77ce58ba951ae91f6587f802f8bb43ce5f2fa73589bcf43b68ca3a8fd9d057ef87d4c8cf7dd29982ae3c288d2f72c8428526daa1d64d9771cc546d275cf87053d045fea2c741d66077327e1a3d5ddf209d9142a7c415d6602109346cb0585b3e612efeb0ac41ff0608e50d69fd66dac26038e3a9436c9d7261ab65bbb49563532383b25e4d96e7f89724fc2e901b79b45e2c7c074aa2775bcf3e49694588ae39e9a6920ff53c94b9a540717f3f3abbf2eeca76fdf7c20f2e4a23ef08629ebf7cfca6c293726f7d59e2c5fc03ea775ae5fbd290e5498bb3d0f8d5e615dee582f74d04c70e67fc612da8d0ee0074e8b3f5e7de4192dbc40dcbb10ad30fd33224b9bb39002be2a407c492662a98d867c7d122bb75809c401a7643ab32722470b919af6b739f3222ea27ba0fececd85285f840b209e266078968fac4a073270b3769e7aef0724ef82468bd4d38cb8d2770156523d6f2ed9801533167951e680711b69a9d18767d0a6dcafa6e4d638b0e19efafb348098a73ba8479cee72f0a7f83e8aaf3d45be4458feef8787e3281d19e1fd84dad83fcc0eba6a4538255769512a1e3cea199f59aa847565c631f26cf47cf1d0fb71392e2dbd3c4611a42d8f437cd7c0dc3632c6c157ea9164e1ffa1c4c45dfe740db354e8b32d73a9f93e355e6a2aef00ab7e906429b4f514ceccc7bc2622a3708441ee1d9a43a1af55bbda78ab980afa05cb14d5504060753f7f595d50c07a9b496a1ab57d630146eff658be229859574ac1be4ab652d6b2039d5b393aa03fdc882c21790db4f6e0fe30c16268100dd55695d0dfc6a91c78a9f2cd09fbba851bae901eb22e946376b8c85617f7114fcca7e65e0a463b9e789ca85be58b9ea65c7008e9b4794ae1422228841c5f5584da495d9061ec7860effa862135daaa93bd26cc5c2ab46bb44404b16e93255ede18e00b7c61ea13a543cf2232e61aaa9adc0e20db069797e35458e9f3f3c6647eeab65cbc9bd5c0848dba44bd0779fdee363e7944bf3b7961b28bb84f18e4317cd19aca0b27295060500d8d119e1e6af3e2179ca990ce93529d8726963968ada3d95761a290053e8aecc91167c67d44762cc23c524af84e0f70d493190d2ea3ad734bcf5ddbd1ecbc6cb0ace2fb3215d7d0914ee1dc111e39559a3cc4ac1177d295ec362d2285a3a8b6b0935600a1ab5bef1c2e31b18c187235dd051be4bad4011ee0abd07539d40fd1649c0f125541c937155cffa90ce018cc57a94d2ea83822356a0f085383df7f4f9664224d0ace4bf0f6d3a27a7849bed2fe0ecb5ed5ddd39aaccce9494e11d832d351e7f4b212936fbb265e00a856a413bd4e6e18e0140817ec6a31d34feb29cebf59efd0736fdf6362a18fe58a089032cc7d5a1a8b3f9881e416235e1952eb2cbd1a3a27ba5ff664227d6537d3c331f565f4c3d2e0f19f1f42b8ad1ed1623cd8fc3e93916accf433ffd30aceeb249b259ab0338e3cfdcb2e8755ca294a22d28344ed1fa8450631bfa6098dae5453ec1ea0cf78768287fe43a068492070dabc826f77ffb5bd3b305cd7d9e0f4128468c160de05fa339172dc6cc906b6da874dc5abf123683074f0c05a4531f3600a6c1a65d78e622582b04cd71fc0a2eaa2e811e8dc0cd00d89c4d9071043eae9e124c131619e37b6d68b0aa1e167bb98f9dec19463b2e1930a39fb67e07a15a7e886a5e62f857007a35d4d687487b693681592d71ab50889543faba7c9047a4c27e47de00bbef32f3b64fa9d0a84712d980423e25632fbdb9e37aa22068e3a0725ba7cc63f5317e8634b87c0ad7ab530ebc2d7899c519964f3570f75f6092a42a26e7d5085326e23b25ef0414126d9168c4c74225e4642682ba58aa459571e3ebd508a451d7387deed43fe10d384eaa6c602c3a4f3a60fe9e08cff85bb031f796dd446d7a2108de04bf06efd7680017311b435bb0d36ccb5cc8d1e85aa6980b278d1bb35f0f9f06cc76ddd9b047089108be63bd628483b026ced478c3aee50e3cfff03d2e0d0e82b797fe217c4fc11e5a510798521a41b22a305c5340c052470755a4a4b1af2e1931877e22fd89238c6712bf1823ed84414e027bf818d09ed493136f8bb5de4c190046f3290c18ac648f6ece727db7548b7916cf566bfbafa20fbeb5d1fc58ffddfb0bdeb258f1aa5979846cd53022946855666ffa061e58c7fa3be9ddd922868779e54c9775ea8c6f8ef9242172d85c097527cd1eeb55bd24dbcde753963b8d33c3e3b835e06286b1af566dfd2b4a0f50f5a713c810103229f9b95a9ecf0fdfc31c4b4b67e65c3ceff9472fe1e015fb08fc38b16d02b8c5f6d31f99bb83bb28d46e8ee7518d006ca6dab24dc35a955e61a0aa5e68087260ee1068776199b54d62b92ba952cb104189e7e04c7379abd702c96a6b92df8f02bd79bb3f93fb5c90827f2216ba723fde14ad8068a50a8f96690f3bdbd06d6004cac2dcb5136a397a5757f69af4e5bcc9ef450566d249d8e28547996c7229807e79741e8c0d8e30b9f42ef89dfbe5706d4088ce461fa7e80e383e1fad7f0fc650993dcc97a307392aee96759df1e026a8f56c0bdef2df064f6849b7049e2d74937e69f444fecbed5d18ec453764a411a5d22b57ce46cd95c95c8c48ac32bd0bce6bd19b2fca228439ddfdd62b51decc20f4340095549bca8520a725a4c669586508f83a49260993c60c0787e9ebc6a97fca288a2b3b0ad1244c508d1050fbfc2b28028d644aae413c495485db5b75323d230a5f4693fbf0ef9f134fbccb452231de5f28271b49c059193f46f1ba16075a2092a3ed171cfd8868fabd21f3d7c42cea5276cddb548236c3943f57fdb852d5ebf8a1a5bdc08f2c6acd6f15c97a3396032ebfbbd3d91442d187847bda801b84edda5687f3d49a14f52e7a3f7baf51a27b88be94b968875b3cd100f7b009ba4da6400b7473cde21a620e1961515757c34b746c5d707ba98c8f54c2fe3c3e11ab44c8aa30485476d43c70b0bffe44b5125c1aa0db1a4298f5e317ea6abafaebca625fbd61d2c7001373cf83893df5cd6cfff6d1505bb65892706f6a65bf3e31e2d413fffc474d7a016604760944a592078bd1d02d677a2e0e9bea91c13ec84f2dfb6dc072ea864b88f2c6cf7a570672f9e316e8cc92ab2c08fe1c068c11c3a154260f3ea0d59eb79d12e198d49da5bb4c0d1ef21ea779e5e185e896a61ad344e03b092ba094ca8d5bbfe95afb1e25f7d2f0c9334740d98baf6c73c9e1a7a1632a8a5646bb045133c3fde473352f1e9fe2f38ce5da8c029ee9a4f31064d97d8b8afae2d813d796ee7914bcfc0191f9575688d199060b11991c5ef38306a7cb2e86bd2f6eb2f7f42f9418d48e7cfe682bb6a6b9f0aa26bb9b6684bf98581e32660676eca8151ddde3f35e662efa044c4f6fbc560b6841cd8231f7be7674eba149442e131953bcf76330f2452c5c4b1d7539ba62a5ddfcb77b2e281f1e28a557a35df9484527c01e3b032570225f95fff811d37babb3349fe1f3efdc8ae766dce4e24c58967579ddc9009b70281e9c01c5651a5cd55ee95e1ccac86286dbdb7ec912a978c68ec6a22daf71073d7280d20d7e6d6072179556d25d31cebce0a557a12093925cdc99889aec6b70b8ce788c420df0e3f03455f8558955899160c7010a6bf01039ed8ffec41a4072f8f1de955e5247c39de2c6e51c90710a46a1dd5e3f3a6d2f95a7b302277483f1497307a29c25100f4caf44d00da52f9ab44292af4485457d388066a14301f6ba64abf07040d14cda6b7ceb1a210d5e8014a712371092ff17ed1f713c4236e3b54bb00ae6c2c3f39c11645ab9edbb5707aee02aa1ad44883f7408491653bc0aa2fee5761425a645d839ced27a80167af762ef97018de64709552c26228897733632744446b640ae704bc349d1d280108b4227eff15f914b3ea58c56d226c64809283ff37931973e78b305609be2f62da8f2836871af1bce9b7cd844130b9bac005276b3d2d737ecdebda3208a6adf4da4c8a3f91a0a4d82c7ffe3a3deeaee7694aff375ca07f0a2ee46d2cdf1eaac43f1a3665843468cc6d4a4ee20011bef4224239e7a41c62cf975dd1eeb60cb1a796f9785fed3a9dcfae80faefed7d436f72db8c7482f3c3a593c2ce6f4f423ce71161d1cbd441025ca18789b9c36b22b7bef9b43010001297558ec8f691f65cc76f4fd40acada6174138c6385451f665ec49b2334ccaf3d78fe140971fe91f59ec675676c66b2368e774277309c607c3b294209050f20dfd4e106033000000000000000115259300d89c137c87dbdf6e59ad3431390fe57f76fd6e330990f5a1b3b642b2bf65cb76aeef001eadae2983192508eb32976ad4db2449da4d28c049e1457f8935ee30791dc50be9cc264d99dfacc8c2b1c8f2efbd2d47f451eb82e48f42cfcba971df515c45681993a373b1ee08e8bdc278bf4652d6304b74fe8d19c763ab3d78db6288b086094152de988256d855f516df4a7eb6b06aff79bcd91830dcb3062d1a4e92a50a416847c04d9d26f36b4d02c37bac43876a7d4a5f02ac1e35fc7e5a8f44df18b1baa1965822fd2348a242b915e818b534106213e685ba1f212c3b77630b3be5f47baecf20092d11409ca27a0c690d6f2d0860e19ff730042993740880fb2eaa5afc32a55b8c4942272e146caee98ba0c8265f9e0ede2728cfcb573406985064def6ec2121b492673498bb556167e5011c9113cdd1ca3852ea368fdcc8dde005a9eb8c8dfeb171e316f3e02e9534f40e482bf93cb51c337022acfe68f8d3bab5374911a56c04c477b9f0fc6796e972e91d2443712f56faf69b3d5348ad0d01ef88272782a1d3acb6ca025bca8905cb5c08b6079ce9307be3755ea6599a2475dc749c0f5078163a6e7aea6419c50e5dd30072a767f5e21809741299b438fecd8b454308f921d5a4157edefbfda18a0be54fc6564972efc04c8ad7308c30fd347d554ad364687e80000c22ac0979971e4981f4b09212f558a84383b2222a7f775ca54ce45238d3a5538be7f21c9f20835a1d0b47bf3dfe01f84848a2aa553efb20655ff41353ca4a22fac61f5a7d119069c2895b0cbc640aa4e997b8f1cb0b726e178b30cace44ec171c3383e0a2d36f9e0666c4e7f87a06455305bdce2a5eee01068a3e863af91e897818cdb4317ce661ab5cc108b80119635b8112771b203d6e21f7649596ac1bfa7f5cd65be756886df4be6e65f89d08d3736577d2dd53610cb43adbef691c77f45b831897e88b03bd33f0e6deda24d439b89e90ec25b632a1476ee04f5d5ed475677e21b01c00672fe01b7631ffb29e2c9c4e9e7f1ae5b9dbc4def83f41023638747f84be5e70abce472daa838d40de4a7f600d23962a29774f46c28b6f541c78c57f4eb53ba734d46aa45b70626876d984e02fe11a904c744f52d36b343467116ca2d5ac36fbe76232f9638241bc0ed7ed1fece77f929df3cda759dad5fed2b773c4577fc8e04475dd020f7d1252f776a89a110b9919c4234d9044a2da7bc146b43e03a7c7d9887f12044a2ca61c15bfdc5d537067e6d00c203a47d132e53aa8ac040bcea77cbcc819be86cae3d1a8aaa7f7bc2832f69effcfe567c13ad7f2fb82a63a478bfd1f6a08b811062be98252ff8899a4a92366ffaee8de837fb75398f27615b2ba0c4ec419c73fa0e6fef2c3d6de615cb2958f4daa68324f93ba12dc7cf325ed59d45ad02f1ca3ab5edd99bdc19b366dea19ec510e12a22fe1533ab8fef5a569035f09f0afeaab3960f51ff6c03b1e192203e098b7b841855e044c6b5c26818deca6f55fcbda26fbdc23225b720f175c089361d695c4e1066006a9c60e457fac07860a11772eee7b1b69cdeb2358f15636adea630406943e40365e9fae820d579098a3b914aa260ef3331b2b875f1cdbddaf8da713b68229e2dd521a6c0408e2a883cbb7c2ba1deafaec861b35b6097d33ccd87aed7de5223dcb714d6fb33f6ca506bde4abef56898649aa2054f27fe6d8604bf66dcd271de6ec4487b4032cc5053e09f786f6fb09d9e29736e5be0af994f81e704720a88aab6240087469f3160146f565d199cdd3ebb93b49faf67d9fae7e683c2307d839a79b2c3997a1a71048fe5609913904b02de3e3e02d990770c90719d4aed6a06e8e42ae6e737fd7436ba332204b31575039c39f8d829f3893c26f7c53cf5b1eb8203761bd130be460568812708ced7ba444963b19e8852c33026e31ad88e52d443d29aa575a730730fd3abf8fba4a0bf5e8af64ba4de9255e0cfb16bf57e42aa1d21766c610fd0838dc1c8ed81b03f837000f538b8c68615499a2fdedb3f07eac95a908732485b79362ba94070c8459106c4f53dc2615e6f618530c37fc5492e0a7e362e117be4c080caaa34c41d3b5168a29b3e89efd06e0e7b3cf19506383d06af41337c0eb6c832a6f8751df091e4461721fbbb01857df41bd17110d4016122a769e37039c1cc684947053d0ac66db1e08cba0130a9e26bf2730d2cba7b7a20eda686a68749bb04b38fb28ae1d1c3a9f37422236e33a7814f61571f9fbd579b095878c4688f22cb14da47c0dfe3b9b385aba06ede469562bd18f19f4e010fc459e4fe99d47f7796fe9fb3fe39886f843c90a108b1d75a4ec61091771cb9334cdc2b85f7ee282142c22c0d9cb54c64759fdcc28547d215c54d1f5d98b266fc5c066811efe79fae460067bb7b7faf150390b9c8481fc28086a4f27e766b426458c39d8d36aa3c9fb4dc5fe25fd651aad1ae43b07dcd77b195ab4e226266fe991bf5b40a0a00992f17141beabee191625199cc8f508a6214e9e0bbf6854313b86222fd50f23a320f27129b0a87d9c71377d7c9ff42df71171353f49ea1662232a504c0121aeab611910eb2d86fdd108fba6fc01684f90ee8290e602f59278d902f3df95012f3b3988d1d78907625693cb811eae25b1aee27525dd89ccfe664b914187ac9a0c194820db231dee5c0d43f4673ef7a110b80c3dbe2c4cfd450ad65934ddae4daa2921bf18fd6ae6c63c767b6eae8fb08bb7b33b0f6563297f0d454f332ea33bac6899d59c8eb17a90a5290e6db44f08c070c3b0b2e8f13e5099d37f1704b3cdf6bdeba51142ec8461996b09921bee59924fea18f2b8cd033b2be2f90b3ea6cbef1ff8aa14583d5c983a44f9e064c65aed45c61879a9d75b96ee6f911900ae894a47b8e22a51f1d66f5091000d6dfe9219c295951f0adc3f6764cd1109f411380ae303af505bf9347238bf0910778983b2900950d9473ceb764a119324a3b323cfcbc661c052840c540c6c595ed7377021a8742fc7835b2cdaf21988f27d9e210f7748c4ac54b758220dc085333291f4767a653a85d7a04541c34557a2e043ab1786b9c41059f62d84ef3d85033fd7581ef5bcc119a81a37a68e02a7ea23f24762ee9751318c1e232536671e0993dc8819584ff4d95fd1aaa539570dba994332dc82842ebcce0806fbf85ce1e1f051b36885a4256b706e15d3844084c70cb64043d5eaefffe662e1eb700e1d58e5908768671e31e8b45f824cc291a1796fbc8abed04515e814db4125313a007b8d1923be44016dd5e8217870b76485d2aeb4991db51c6a1ba2e502f328a90ace24d5c22cdca0f43d980bfba05d4ace2a6c7af71ab809f175d1df3a0f4b344315a8f96be6386e0be955ba8f65f08818b283ba6b8fba153a9996d7db26acd3b300121b0fbe8019e68a8a49c284d72de9d6a398624ca61f0160e7bdb08d778082f8fe6cd8b662943c25743fc4b2ff521690f5213d1252fc994f1ef7865368195210cdc4331a5deed52ecbf0f5cbb1ac05e87d8bd5e70e7eaeb9f0ebc7d594d1c79bde935e6966a625a6ef962c6f89d6a93f4debc135bdd2828a1e5c42c08fb5e9bde2807cc837fa2c86cf80287cec45505758d7d7031b8c6a3d2f44fb0e0f7a47a7320c3ca3f117a7fbcbec93de42854578702a03e3641474c19c9d6e5f2c1beae241d846624bcd0cc9bf065392d23153491355e3cbb39a94aac14e222593c320c337f4116e193522ec06b858693b0e74abddb61733f0c85b355a9500e2c10755b9a2868888d1e0e92bac03db91576c707da7c94dcb8632db2fb2802be63b9471118d2b695cf2d995431bf7d5fc9cd3d96ae7f83ff135d47ab86d6422ef881824dc4dcd248e2aab160b31a9a61c0a73b21a141e3fcc58235099f3fae0230625cef5e4a3629faee9e8128f95f82556a626396a662cb00886261a51032b5f47e7bec6c7f4aa790c46e65ba13137cc887c0bf3d53de82d69bdcdf61cf35415582294442c2dedabc33125078c5225e11d4aac0a4974a0f39a6e3bd7b66050f16fdc5ac69e2991b468710a9b1295173d27a52aa3304b816a590e8c8a9756241474ee374550265aca73711a0cdc8802a484cbc1bac0b678a95a156adaee01c6d5ce4cc0a166d4398d0bd9b878bcf70b038e586127708b67abb17a9e6f876986423c8543421fc882c572efd940cf803924a15847afbfc0b95b032f0a315293b2500ed02b246a057daeb3da3bd6cc90866849a216582172041075c7b0891b619f2f606297b91a45a477bf334d6998b354dd1eb6834241d43274984ccba309755f5ac55a7ee8971e046374977cea1733ece8e635cbc102ce0b3f6da5ea772be5776191f6b9dbbd1d31d02fc19fa9846d3fdda175a861fae4fb6eaa0ee2ab87ac7aeae9c0d42b9f5e8b9557ed9355491afa07e7120cb1c825e0a207955380c5ecc183b647488146f2423097611069dba72873118d127580d2dc93c0f2b821a1a5403c089f0b259b9f285aef80f8d3107ce83052055a1438e01ecc2f836368d4f3148f5687c636cec730e25b007e67349729a0e1d62e0628d42137e131651308695b7b6401d7bcc65ef7f1a3b899d4e9fc40db6ad2ab63bdc88b84e521d8075317e16736c296e6d2a7529dfa4c6fcec74f1e3b3734f5b4e7ce83cec91dd08d9ed05090e2ba5e4a2d5ebaf86f14d6cc1c455c71e3b02aade7bac9ab64c8233d6a7eb7dcc13cd2d24fbe773c42fcac4c64b99bedcca62fa62c1801ed51409a87ebd734794553cc61a0020bda32b84cb525a8b78d7a1c539c97f68512a13fc5fed0a4a880cc6534305b25838b1e7de3ada14799ca58aa91c998cf2353c44300648d42adb6d888dcf776394447437735302c3e634653441178e422007e9c86df14d9055d86114a8a879cdc9cd3686cc583993774a251280236e3a95c32af5e54779f08f118915eae1ac5960ed57aedd1297dc8ac4717293688eed3f72d64d45712ba0ddf66fc5dce4dffe51bcbd00a833ab4bfd77e17eac803f837470a18d8c942c61bf67319961d1e697ebf67d3381d5c7f2ab24f12fea2ce583f76db8e267ba9c623f11dc627bbf50ad2dd04f434d5429d354a57f96e2123f3ba60578fc55e944fbe6fe5c2a516cc4168cf81f7b0b07cea277474a172b005a0490641b5c837a4711a7324a1db8cfa4c02211259882f962cc97b2b8fcf979130ecab33f26b43b332460c12ae78f019f3037f9445ee0e7020d3a28593a944cf0d1b2bd2970e7f6bfe6cbc477b1024b639fb5bc1f4b65db41dc117d2a1b768dcd6be6eb48817912ca85cb8b0fcd66c8e3774cfd8944fd0ca97ed0bc3c636cecb6af378e98681ab89dff70d4425adc76f01dcc850deea73cca83455cf4ad12c5f95d78dd33a46f350beb71950a32c268c81d4e450c6e57debc36a58f5762df7910d82296de452c960be95f119c1e0c18001f14d29628f682150d8d8a6bae08c19c1cc3871a5e832ed2737113bbed761df09ebcc59fe2227fda12b582206cf158bfd320f2690565f6a102481804286f6d26a16df2f8a2ba9b22f64c860749c63a55a024208f7274909c0d46ab0a9c5f5497eff8f734b4d91cc80c3b4936f2fbdeb2dfa7ae66220b59c40fd35abb11ecea40ededa0e52c23e60707cda60b918d12cf1a6aa6d61dbdee847c1dfbd19e6319c8e1f2a35d7d31a622ee9bcbfc6daaf4a69de7c795fc0be6f53b72d4c4121591cf6a3ad3e7692fc65ad6990b33561ef117834e5a229b5c7a9f06c3533a887c35b6cf239421d96a0ff90af23fe2f173ee16f641dc5a6c133c84103d595c07b545190a1b4fbe703c4410a6108d17a55c247696e1deef5fb577171da3a66646c70cdc474c431f8dae0fab6a60000").unwrap();
    static ref TEST_P2TR_ADDR: Address = Address::from_str("tlq1pq0wqu32e2xacxeyps22x8gjre4qk3u6r70pj4r62hzczxeyz8x3yxucrpn79zy28plc4x37aaf33kwt6dz2nn6gtkya6h02mwpzy4eh69zzexq7cf5y5").unwrap();
}

impl MockWallet {
    pub(crate) fn new() -> Self {
        Self {}
    }
}

#[async_trait]
impl OnchainWallet for MockWallet {
    async fn transactions(&self) -> Result<Vec<WalletTx>, PaymentError> {
        Ok(vec![])
    }

    async fn build_tx(
        &self,
        _fee_rate: Option<f32>,
        _recipient_address: &str,
        _amount_sat: u64,
    ) -> Result<Transaction, PaymentError> {
        Ok(TEST_LIQUID_TX.clone())
    }

    async fn build_drain_tx(
        &self,
        _fee_rate_sats_per_kvb: Option<f32>,
        _recipient_address: &str,
        _enforce_amount_sat: Option<u64>,
    ) -> Result<Transaction, PaymentError> {
        Ok(TEST_LIQUID_TX.clone())
    }

    async fn build_tx_or_drain_tx(
        &self,
        _fee_rate_sats_per_kvb: Option<f32>,
        _recipient_address: &str,
        _amount_sat: u64,
    ) -> Result<Transaction, PaymentError> {
        Ok(TEST_LIQUID_TX.clone())
    }

    async fn next_unused_address(&self) -> Result<Address, PaymentError> {
        Ok(TEST_P2TR_ADDR.clone())
    }

    async fn tip(&self) -> Tip {
        unimplemented!()
    }

    fn pubkey(&self) -> Result<String> {
        unimplemented!()
    }

    fn fingerprint(&self) -> Result<String> {
        unimplemented!()
    }

    fn sign_message(&self, _message: &str) -> Result<String> {
        unimplemented!()
    }

    fn check_message(&self, _message: &str, _pubkey: &str, _signature: &str) -> Result<bool> {
        unimplemented!()
    }

    async fn full_scan(&self) -> Result<(), PaymentError> {
        Ok(())
    }
}

pub(crate) struct MockSigner {}

impl MockSigner {
    pub(crate) fn new() -> Self {
        Self {}
    }
}

impl Signer for MockSigner {
    fn xpub(&self) -> Result<Vec<u8>, SignerError> {
        todo!()
    }

    fn derive_xpub(&self, _derivation_path: String) -> Result<Vec<u8>, SignerError> {
        todo!()
    }

    fn sign_ecdsa(&self, _msg: Vec<u8>, _derivation_path: String) -> Result<Vec<u8>, SignerError> {
        todo!()
    }

    fn sign_ecdsa_recoverable(&self, _msg: Vec<u8>) -> Result<Vec<u8>, SignerError> {
        todo!()
    }

    fn slip77_master_blinding_key(&self) -> Result<Vec<u8>, SignerError> {
        todo!()
    }

    fn hmac_sha256(&self, _msg: Vec<u8>, _derivation_path: String) -> Result<Vec<u8>, SignerError> {
        todo!()
    }
}
